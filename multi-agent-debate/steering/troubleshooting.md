# 疑難排解指南

本文件提供多代理辯證系統使用過程中常見問題的診斷和解決方案。

## 🚨 常見問題與解決方案

### 問題 1：代理提出的方案過於相似

#### 症狀
- 三個 Agent 的方案基本相同
- 只有細微的差別
- 缺乏真正的辯證過程

#### 可能原因
1. **需求描述過於具體**：已經暗示了特定的解決方向
2. **角度配置不當**：Orchestrator 選擇的角度過於相近
3. **約束條件過多**：限制了方案的多樣性

#### 解決方案

**方案 A：重新描述需求**
```bash
# 原始描述（過於具體）
/debate 使用 Redis 快取來優化資料庫查詢效能

# 改進描述（更開放）
/debate 我們的資料庫查詢回應時間過長，需要優化效能。現況：MySQL，平均查詢時間 2 秒，目標：<500ms
```

**方案 B：自訂思考角度**
```bash
/debate 優化資料庫效能 --perspectives "快取策略,查詢優化,架構重構"
```

**方案 C：減少約束條件**
```bash
# 原始（約束過多）
需求：使用現有的 Node.js + MySQL 技術棧，不能增加新的中間件，預算限制在 1 萬元內，必須在 2 週內完成

# 改進（保留核心約束）
需求：優化 Node.js + MySQL 應用的效能，預算中等，希望儘快完成
```

### 問題 2：辯論陷入僵局，無法達成共識

#### 症狀
- 達到最大輪數仍未達成共識
- Agent 堅持各自立場不妥協
- 評分差距很小，難以決定

#### 可能原因
1. **評估標準不明確**：缺乏清晰的優先級
2. **方案優劣勢相當**：確實難以選擇
3. **缺乏決定性因素**：沒有關鍵的區分標準

#### 解決方案

**方案 A：介入提供額外標準**
```
介入：請特別重視維護成本，這個系統需要運行 5 年，團隊只有 2 個開發者
```

**方案 B：要求混合方案**
```
介入：請各 Agent 考慮提出混合方案，結合其他方案的優點
```

**方案 C：階段性決策**
```
介入：請分兩個階段考慮：
1. 第一階段（3 個月內）：快速解決當前問題
2. 第二階段（6-12 個月）：長期優化方案
```

**方案 D：讓 Critic 最終裁決**
```
選擇：採納 → 讓 Critic 根據評分進行最終裁決
```

### 問題 3：方案過於理論化，缺乏實施細節

#### 症狀
- 方案描述很抽象
- 缺乏具體的實施步驟
- 成本和時程估算不準確

#### 可能原因
1. **需求背景不足**：缺乏技術棧和團隊資訊
2. **實施約束不明**：沒有說明實際的限制條件
3. **Agent 缺乏上下文**：不了解具體的實施環境

#### 解決方案

**方案 A：補充技術背景**
```
介入：補充資訊 - 
技術棧：React + Node.js + PostgreSQL
團隊：3 個全端開發者，1 個 DevOps
基礎設施：AWS，已有 CI/CD 流程
```

**方案 B：要求詳細計劃**
```
介入：請各 Agent 提供：
1. 詳細的實施步驟（週為單位）
2. 具體的技術選型和配置
3. 風險緩解的具體措施
```

**方案 C：提供參考案例**
```
介入：參考資訊 - 類似的專案我們之前用了 6 週完成，遇到的主要問題是資料遷移和效能調優
```

### 問題 4：Critic 的挑戰過於表面或不夠深入

#### 症狀
- 挑戰問題很泛泛
- 沒有針對方案的核心弱點
- Agent 很容易回應，沒有真正的改進

#### 可能原因
1. **方案本身品質不高**：缺乏足夠的細節供批判
2. **評估標準不清楚**：Critic 不知道重點關注什麼
3. **領域知識不足**：對特定技術領域了解有限

#### 解決方案

**方案 A：提供評估重點**
```
介入：請 Critic 特別關注：
1. 資料一致性問題
2. 高併發情況下的效能
3. 故障恢復機制
```

**方案 B：要求更詳細的方案**
```
介入：請各 Agent 提供更詳細的技術方案，包括：
- 具體的程式碼架構
- 資料庫設計
- API 設計
```

**方案 C：提供領域知識**
```
介入：背景知識 - 
我們之前在類似場景遇到過：
1. 快取穿透問題
2. 資料庫連線池耗盡
3. 記憶體洩漏導致的效能下降
```

### 問題 5：Agent 回應挑戰時過於防禦性

#### 症狀
- Agent 拒絕承認方案的問題
- 回應缺乏建設性
- 不願意修正方案

#### 可能原因
1. **角色設定問題**：過於強調「堅持立場」
2. **挑戰過於激進**：Critic 的批判過於嚴厲
3. **缺乏改進空間**：方案已經相對完善

#### 解決方案

**方案 A：調整期望**
```
介入：提醒各 Agent - 目標是找到最佳方案，不是贏得辯論。承認問題並改進是加分的。
```

**方案 B：提供改進方向**
```
介入：建議各 Agent 考慮：
1. 如何降低實施風險
2. 如何提升方案的可維護性
3. 如何處理邊界情況
```

**方案 C：重新設定角度**
```
選擇：重設角度 → 調整思考角度，讓 Agent 有更多改進空間
```

## 🔧 系統層面問題

### 問題 6：執行過程中出現錯誤

#### 常見錯誤類型

**錯誤 A：Agent 執行失敗**
```
錯誤訊息：Agent execution failed
```

**診斷步驟**：
1. 檢查需求描述是否過於複雜
2. 確認是否有特殊字符或格式問題
3. 嘗試簡化需求重新執行

**解決方案**：
```bash
# 簡化需求描述
/debate 優化網站載入速度

# 而不是
/debate 優化我們公司的電商網站在高峰期（每秒 1000+ 請求）的載入速度，特別是商品列表頁面的 SQL 查詢效能問題...
```

**錯誤 B：並行執行衝突**
```
錯誤訊息：Concurrent execution conflict
```

**解決方案**：
1. 等待當前辯證完成
2. 避免同時啟動多個辯證流程
3. 檢查系統資源使用情況

**錯誤 C：檔案寫入失敗**
```
錯誤訊息：File write permission denied
```

**解決方案**：
1. 檢查工作目錄權限
2. 確認磁碟空間充足
3. 重新啟動 Kiro IDE

### 問題 7：效能問題

#### 症狀
- 辯證過程執行緩慢
- Agent 回應時間過長
- 系統資源使用率高

#### 可能原因
1. **需求過於複雜**：包含太多背景資訊
2. **並行執行過多**：同時運行多個 Agent
3. **系統資源不足**：記憶體或 CPU 不夠

#### 解決方案

**方案 A：優化需求描述**
```bash
# 避免過長的需求描述
# 將複雜需求分解為多個簡單需求
```

**方案 B：調整執行參數**
```bash
# 減少最大輪數
/debate 需求描述 --max-rounds 3

# 使用更明確的角度
/debate 需求描述 --perspectives "角度1,角度2,角度3"
```

**方案 C：系統優化**
- 關閉不必要的應用程式
- 增加系統記憶體
- 檢查網路連線狀況

## 📋 診斷檢查清單

### 使用前檢查

- [ ] 需求描述是否清晰具體？
- [ ] 是否包含必要的背景資訊？
- [ ] 約束條件是否合理？
- [ ] 成功標準是否明確？

### 執行中監控

- [ ] Agent 方案是否有足夠差異？
- [ ] Critic 挑戰是否深入有效？
- [ ] Agent 回應是否建設性？
- [ ] 是否朝向共識收斂？

### 結果評估

- [ ] 最終方案是否可行？
- [ ] 是否充分考慮了風險？
- [ ] 實施計劃是否詳細？
- [ ] 是否符合原始需求？

## 🎯 效能優化建議

### 需求描述優化

**好的實踐**：
```
需求：優化電商網站的商品搜尋功能

背景：
- 技術棧：React + Node.js + Elasticsearch
- 問題：搜尋回應時間 >3 秒
- 目標：<1 秒回應時間
- 約束：不能影響現有功能

成功標準：
- 搜尋回應時間 <1 秒
- 搜尋準確度不下降
- 系統穩定性保持
```

**避免的做法**：
```
需求：我們的網站很慢，用戶抱怨很多，老闆很生氣，需要趕快修好，但是不能花太多錢，也不能影響其他功能，而且我們團隊人手不夠，技術也不是很強...
```

### 互動策略優化

1. **適時介入**：不要等到最後才提供關鍵資訊
2. **漸進引導**：逐步提供更多細節和約束
3. **保持開放**：相信辯證過程，避免過早下結論
4. **記錄洞察**：注意過程中產生的新想法

### 系統使用優化

1. **單一焦點**：一次只處理一個核心問題
2. **分階段處理**：複雜問題分解為多個階段
3. **累積經驗**：記錄成功的模式和策略
4. **持續改進**：根據結果調整使用方式

## 🆘 緊急情況處理

### 當系統完全無回應時

1. **立即行動**：
   - 儲存當前進度
   - 重新啟動 Kiro IDE
   - 檢查系統資源

2. **恢復策略**：
   - 從最後一個成功的輪次重新開始
   - 簡化需求描述
   - 減少並行執行

3. **預防措施**：
   - 定期儲存進度
   - 監控系統資源使用
   - 避免過於複雜的需求

### 當結果完全不符合預期時

1. **問題診斷**：
   - 檢查需求描述是否準確
   - 確認角度配置是否合適
   - 評估是否提供了足夠的背景

2. **快速修正**：
   - 重新描述需求
   - 使用自訂角度
   - 提供更多約束條件

3. **學習改進**：
   - 記錄問題和解決方案
   - 調整未來的使用策略
   - 建立最佳實踐庫

---

透過這個疑難排解指南，您可以快速診斷和解決使用多代理辯證系統時遇到的各種問題，確保獲得高品質的決策分析結果。